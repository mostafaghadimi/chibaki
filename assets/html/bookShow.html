<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/assets/stylesheet/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/stylesheet/stylesheet.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="/assets/javascript/jquery.min.js"></script>
    <script src="/assets/javascript/bootstrap.min.js"></script>
    <title>لیست کتاب‌ها</title>
</head>

<body class="text-center">
    <div class="form-signin">
        <h3>لیست کتاب‌ها</h3>
        <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="isPageNoSorted">
                <label class="form-check-label" for="defaultCheck1" dir="rtl">
                    مرتب‌سازی براساس تعداد صفحات
                </label>
            </div>
        <br>
        <table class="table">
            <tr>
                <th>حذف</th>
                <th>ویرایش</th>
                <th>تعداد صفحات</th>
                <th>نام کتاب</th>
            </tr>
        </table>
        <div>

        </div>
    </div>
</body>
<script>
    var isPageNoSorted = $("#isPageNoSorted").prop("checked");
    $('#isPageNoSorted').change(function() {
        if ($(this).is(':checked')){
            $('table').html('<tr><th>حذف</th><th>ویرایش</th><th>تعداد صفحات</th><th>نام کتاب</th></tr>')
            $.get('/bookShow/' + $(this).is(':checked') + '/1', function(data){
                $('table').append(data.map((book, i) => {
                const $tr = $('<tr>', {
                    append: `
                            <td></td>
                            <td></td>
                            <td>${book.pageCount}</td>
                            <td>${book.name}</td>
                        `
                });
                const $btnDel = $("<button>", {
                    appendTo: $('td:eq(0)', $tr),
                    "class": "deleteButton",
                    html: "<i class='material-icons'>delete</i>",
                    on: {
                        click: function () {
                            console.log(`Deleting: ${book.name}`)
                            $.post(`/delete/${book.name}`).done(() => {
                                location.reload(true);
                            })
                        }
                    }
                });
                const $btnEdit = $('<button>', {
                    appendTo: $('td:eq(1)', $tr),
                    "class": "editButton",
                    html: "<i class='material-icons'>edit</i>",
                    on: {
                        click: function () {
                            console.log(`Editing: ${book.name}`)
                            $.post(`/edit/${book.name}`, {
                                //TODO: injaro anjam bedam
                            }).done(() => {
                                window.location.assign('/deletedBooks')
                            })
                        }
                    }
                });
                return $tr;
            }));            })
        }
        else {
            $('table').html('<tr><th>حذف</th><th>ویرایش</th><th>تعداد صفحات</th><th>نام کتاب</th></tr>')
            $.get('/bookShow/' + $(this).is(':checked') + '/1', function(data){
                $('table').append(data.map((book, i) => {
                const $tr = $('<tr>', {
                    append: `
                            <td></td>
                            <td></td>
                            <td>${book.pageCount}</td>
                            <td>${book.name}</td>
                        `
                });
                const $btnDel = $("<button>", {
                    appendTo: $('td:eq(0)', $tr),
                    "class": "deleteButton",
                    html: "<i class='material-icons'>delete</i>",
                    on: {
                        click: function () {
                            console.log(`Deleting: ${book.name}`)
                            $.post(`/delete/${book.name}`).done(() => {
                                location.reload(true);
                            })
                        }
                    }
                });
                const $btnEdit = $('<button>', {
                    appendTo: $('td:eq(1)', $tr),
                    "class": "editButton",
                    html: "<i class='material-icons'>edit</i>",
                    on: {
                        click: function () {
                            console.log(`Editing: ${book.name}`)
                            $.post(`/edit/${book.name}`, {
                                //TODO: injaro anjam bedam
                            }).done(() => {
                                window.location.assign('/deletedBooks')
                            })
                        }
                    }
                });
                return $tr;
            }));            })
        }
    })
    jQuery($ => {

        $.getJSON('/bookShow/' + isPageNoSorted + '/1', (json) => {
            $('table').append(json.map((book, i) => {
                const $tr = $('<tr>', {
                    append: `
                        <td></td>
                        <td></td>
                        <td>${book.pageCount}</td>
                        <td>${book.name}</td>
                    `
                });
                const $btnDel = $("<button>", {
                    appendTo: $('td:eq(0)', $tr),
                    "class": "deleteButton",
                    html: "<i class='material-icons'>delete</i>",
                    on: {
                        click: function () {
                            console.log(`Deleting: ${book.name}`)
                            $.post(`/delete/${book.name}`).done(() => {
                                location.reload(true);
                            })
                        }
                    }
                });
                const $btnEdit = $('<button>', {
                    appendTo: $('td:eq(1)', $tr),
                    "class": "editButton",
                    html: "<i class='material-icons'>edit</i>",
                    on: {
                        click: function () {
                            console.log(`Editing: ${book.name}`)
                            $.post(`/edit/${book.name}`, {
                                //TODO: injaro anjam bedam
                            }).done(() => {
                                window.location.assign('/deletedBooks')
                            })
                        }
                    }
                });
                return $tr;
            }));
        });
    });
</script>

</html>